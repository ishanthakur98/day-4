apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: bluegreen-demo
spec:
  replicas: 3
  revisionHistoryLimit: 2
  selector:
    matchLabels:
      app: bluegreen-demo
  template:
    metadata:
      labels:
        app: bluegreen-demo
    spec:
      containers:
      - name: app
        image: nginx:1.25-alpine
        ports:
        - containerPort: 80
        env:
        - name: VERSION
          value: "1.0.0"
        volumeMounts:
        - name: html
          mountPath: /usr/share/nginx/html
      volumes:
      - name: html
        configMap:
          name: bluegreen-html
  strategy:
    blueGreen:
      activeService: bluegreen-active
      previewService: bluegreen-preview
      autoPromotionEnabled: false
---
apiVersion: v1
kind: Service
metadata:
  name: demo-app
spec:
  type: NodePort
  selector:
    app: demo-app
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
    nodePort: 30080
---
apiVersion: v1
kind: Service
metadata:
  name: bluegreen-preview
spec:
  type: LoadBalancer
  selector:
    app: bluegreen-demo
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: bluegreen-html
data:
  index.html: |
    <!DOCTYPE html>
    <html>
    <head><title>Blue-Green Demo</title></head>
    <body style="font-family: Arial; margin: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
      <div style="background: rgba(255,255,255,0.1); padding: 40px; border-radius: 10px;">
        <h1>ðŸ”µ Blue Deployment (Active)</h1>
        <p><strong>Version:</strong> 1.0.0</p>
        <p><strong>Strategy:</strong> Blue-Green with Argo Rollouts</p>
        <p>This is the ACTIVE (production) version.</p>
      </div>
    </body>
    </html>
